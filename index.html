<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¬ê¸°ë¡œìš´ ì‹¬ì˜ ìƒí™œ - N2B ê¸°ë°˜ ì‹¬ì˜ ë„ìš°ë¯¸</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', 'Noto Sans KR', Arial, sans-serif; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* í—¤ë” */
        .header { 
            background: linear-gradient(135deg, #e94560 0%, #533483 50%, #0f3460 100%);
            color: white; 
            padding: 40px; 
            border-radius: 20px; 
            margin-bottom: 30px; 
            text-align: center;
            box-shadow: 0 10px 40px rgba(233, 69, 96, 0.3);
        }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header .subtitle { font-size: 1.2em; opacity: 0.9; }
        .header .n2b-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 8px 20px;
            border-radius: 20px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid rgba(255,255,255,0.2);
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 15px;
        }
        .tab-btn:hover { background: rgba(255,255,255,0.2); }
        .tab-btn.active { 
            background: #e94560; 
            border-color: #e94560;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }
        
        /* ì¹´ë“œ */
        .card { 
            background: rgba(255,255,255,0.95); 
            padding: 30px; 
            margin: 20px 0; 
            border-radius: 16px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }
        .card h2 { 
            color: #1a1a2e; 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }
        .card.hidden { display: none; }
        
        /* ì…ë ¥ í•„ë“œ */
        .input-group { margin-bottom: 20px; }
        .input-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: 600; 
            color: #333;
        }
        .input-field { 
            width: 100%; 
            padding: 14px 18px; 
            border: 2px solid #e0e0e0; 
            border-radius: 12px; 
            font-size: 15px;
            transition: border-color 0.3s;
        }
        .input-field:focus { 
            outline: none; 
            border-color: #e94560; 
        }
        select.input-field { cursor: pointer; }
        textarea.input-field { min-height: 120px; resize: vertical; }
        
        /* ì—…ë¡œë“œ ì˜ì—­ */
        .upload-area { 
            border: 3px dashed #ddd; 
            padding: 50px; 
            text-align: center; 
            border-radius: 16px; 
            transition: all 0.3s;
            background: #fafafa;
        }
        .upload-area:hover { border-color: #e94560; background: #fff5f7; }
        .upload-area.dragover { border-color: #e94560; background: #fff0f3; }
        .upload-area h3 { color: #555; margin-bottom: 15px; }
        .upload-area p { color: #888; margin-bottom: 20px; }
        
        /* ë²„íŠ¼ */
        .btn { 
            border: none; 
            padding: 14px 32px; 
            border-radius: 30px; 
            font-size: 16px; 
            cursor: pointer; 
            transition: all 0.3s;
            font-weight: 600;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #e94560 0%, #533483 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.3);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(233, 69, 96, 0.4); }
        .btn-secondary { background: #6c757d; color: white; }
        .btn-success { background: linear-gradient(135deg, #38a169 0%, #2d7d5a 100%); color: white; }
        .btn-outline {
            background: transparent;
            border: 2px solid #e94560;
            color: #e94560;
        }
        .btn-outline:hover { background: #e94560; color: white; }
        
        /* ì‹¬ì˜ ìœ í˜• ì„ íƒ ì¹´ë“œ */
        .review-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .review-type-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid transparent;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        .review-type-card:hover { border-color: #e94560; transform: translateY(-3px); }
        .review-type-card.selected { 
            border-color: #e94560; 
            background: linear-gradient(135deg, #fff0f3 0%, #ffe0e6 100%);
        }
        .review-type-card .icon { font-size: 2.5em; margin-bottom: 10px; }
        .review-type-card h4 { color: #333; margin-bottom: 5px; }
        .review-type-card p { font-size: 0.85em; color: #666; }
        
        /* N2B ë¶„ì„ ê²°ê³¼ */
        .n2b-result-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .n2b-box {
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid;
        }
        .n2b-box.n-box { 
            background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
            border-left-color: #e53e3e;
        }
        .n2b-box.b-box { 
            background: linear-gradient(135deg, #f0fff4 0%, #e0ffe8 100%);
            border-left-color: #38a169;
        }
        .n2b-box.c-box { 
            background: linear-gradient(135deg, #fffaf0 0%, #fff0d4 100%);
            border-left-color: #d69e2e;
        }
        .n2b-box h4 { margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .n2b-box ul { list-style: none; padding: 0; }
        .n2b-box li { 
            padding: 10px 15px; 
            background: rgba(255,255,255,0.7); 
            border-radius: 8px; 
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        /* í‰ê°€ ì ìˆ˜ */
        .score-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .score-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .score-item.ëª…ì‹¤ìƒë¶€ { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .score-item.ê³µì¡´ { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .score-item.ë…¼ë¦¬ì„± { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
        .score-item .score-value { font-size: 2.5em; font-weight: bold; }
        .score-item .score-label { font-size: 0.9em; opacity: 0.9; margin-top: 5px; }
        
        /* ì‹¬ì˜ ì˜ê²¬ì„œ */
        .opinion-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
        }
        .opinion-section h4 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e94560;
        }
        .opinion-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            line-height: 1.8;
            white-space: pre-wrap;
        }
        
        /* ì²´í¬ë¦¬ìŠ¤íŠ¸ */
        .checklist {
            display: grid;
            gap: 12px;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .checklist-item:hover { background: #f0f0f0; }
        .checklist-item.checked { background: #e8f5e9; }
        .checklist-item input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: #e94560;
        }
        .checklist-item label { flex: 1; cursor: pointer; }
        
        /* ë¡œë”© */
        .loading {
            text-align: center;
            padding: 60px;
        }
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e94560;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* í”„ë¡œê·¸ë ˆìŠ¤ ë°” */
        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            height: 12px;
            margin: 15px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e94560, #533483);
            transition: width 0.5s ease;
        }
        
        /* ê²°ê³¼ ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            margin: 30px 0;
        }
        
        /* ë“±ê¸‰ ë°°ì§€ */
        .grade-badge {
            display: inline-block;
            padding: 10px 25px;
            border-radius: 25px;
            font-size: 1.5em;
            font-weight: bold;
        }
        .grade-excellent { background: linear-gradient(135deg, #38a169 0%, #2d7d5a 100%); color: white; }
        .grade-good { background: linear-gradient(135deg, #3182ce 0%, #2b6cb0 100%); color: white; }
        .grade-normal { background: linear-gradient(135deg, #d69e2e 0%, #b7791f 100%); color: white; }
        .grade-poor { background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%); color: white; }
        
        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .tab-nav { justify-content: center; }
            .card { padding: 20px; }
        }
        
        /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
        @media print {
            body { background: white; }
            .btn, .tab-nav, .upload-area { display: none; }
            .card { box-shadow: none; border: 1px solid #ddd; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ“‹ ìŠ¬ê¸°ë¡œìš´ ì‹¬ì˜ ìƒí™œ</h1>
            <p class="subtitle">N2B í”„ë ˆì„ì›Œí¬ ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ì‹¬ì˜ ë„ìš°ë¯¸</p>
            <div class="n2b-badge">ğŸ§¬ Not â†’ But â†’ Because | ëª…ì‹¤ìƒë¶€ Â· ê³µì¡´</div>
        </div>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="showTab('input')">ğŸ“ ì‹¬ì˜ ì…ë ¥</button>
            <button class="tab-btn" onclick="showTab('analysis')">ğŸ” N2B ë¶„ì„</button>
            <button class="tab-btn" onclick="showTab('opinion')">ğŸ“„ ì‹¬ì˜ ì˜ê²¬ì„œ</button>
            <button class="tab-btn" onclick="showTab('checklist')">âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸</button>
            <button class="tab-btn" onclick="showTab('guide')">ğŸ“š ì‹¬ì˜ ê°€ì´ë“œ</button>
        </div>
        
        <!-- íƒ­ 1: ì‹¬ì˜ ì…ë ¥ -->
        <div id="tab-input" class="tab-content">
            <!-- ì‹¬ì˜ì ì •ë³´ -->
            <div class="card">
                <h2>ğŸ‘¤ ì‹¬ì˜ì ì •ë³´</h2>
                <div class="input-group">
                    <label>ì‹¬ì˜ìœ„ì› ì„±ëª…</label>
                    <input type="text" id="reviewerName" class="input-field" placeholder="í™ê¸¸ë™">
                </div>
                <div class="input-group">
                    <label>ì†Œì† ê¸°ê´€</label>
                    <input type="text" id="reviewerOrg" class="input-field" placeholder="í•œêµ­ê±´ì„¤ê¸°ìˆ ì—°êµ¬ì›">
                </div>
                <div class="input-group">
                    <label>ì „ë¬¸ ë¶„ì•¼</label>
                    <input type="text" id="reviewerField" class="input-field" placeholder="ë„ë¡œêµí†µ, AI ì‘ìš©">
                </div>
            </div>
            
            <!-- ì‹¬ì˜ ìœ í˜• ì„ íƒ -->
            <div class="card">
                <h2>ğŸ“Œ ì‹¬ì˜ ìœ í˜• ì„ íƒ</h2>
                <div class="review-type-grid">
                    <div class="review-type-card" onclick="selectReviewType(this, 'planning')" data-type="planning">
                        <div class="icon">ğŸ“‹</div>
                        <h4>ê¸°íší‰ê°€</h4>
                        <p>ê³¼ì œ ê¸°íš ë‹¨ê³„ ì‹¬ì˜</p>
                    </div>
                    <div class="review-type-card" onclick="selectReviewType(this, 'selection')" data-type="selection">
                        <div class="icon">ğŸ¯</div>
                        <h4>ì„ ì •í‰ê°€</h4>
                        <p>ê³¼ì œ ì„ ì •/íƒˆë½ ì‹¬ì˜</p>
                    </div>
                    <div class="review-type-card" onclick="selectReviewType(this, 'interim')" data-type="interim">
                        <div class="icon">ğŸ“Š</div>
                        <h4>ì¤‘ê°„í‰ê°€</h4>
                        <p>ì—°ì°¨/ë‹¨ê³„ í‰ê°€ ì‹¬ì˜</p>
                    </div>
                    <div class="review-type-card" onclick="selectReviewType(this, 'final')" data-type="final">
                        <div class="icon">ğŸ†</div>
                        <h4>ìµœì¢…í‰ê°€</h4>
                        <p>ê³¼ì œ ì¢…ë£Œ í‰ê°€ ì‹¬ì˜</p>
                    </div>
                    <div class="review-type-card" onclick="selectReviewType(this, 'followup')" data-type="followup">
                        <div class="icon">ğŸ”„</div>
                        <h4>ì¶”ì í‰ê°€</h4>
                        <p>ì„±ê³¼ í™œìš© ì¶”ì  ì‹¬ì˜</p>
                    </div>
                    <div class="review-type-card" onclick="selectReviewType(this, 'other')" data-type="other">
                        <div class="icon">ğŸ“‘</div>
                        <h4>ê¸°íƒ€ ì‹¬ì˜</h4>
                        <p>ì •ì±…/ì œë„ ì‹¬ì˜ ë“±</p>
                    </div>
                </div>
            </div>
            
            <!-- API ì„¤ì • -->
            <div class="card">
                <h2>ğŸ”‘ AI ì„¤ì •</h2>
                <div class="input-group">
                    <label>OpenAI API Key</label>
                    <input type="password" id="apiKey" class="input-field" placeholder="sk-proj-...">
                    <p style="margin-top: 8px; font-size: 13px; color: #666;">
                        ğŸ’¡ <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI API Key ë°œê¸‰ë°›ê¸°</a> | GPT-4o-mini ëª¨ë¸ ì‚¬ìš©
                    </p>
                </div>
            </div>
            
            <!-- ë¬¸ì„œ ì—…ë¡œë“œ -->
            <div class="card">
                <h2>ğŸ“ ì‹¬ì˜ ëŒ€ìƒ ë¬¸ì„œ</h2>
                <div class="upload-area" id="uploadArea">
                    <input type="file" id="fileInput" accept=".txt,.pdf" style="display: none;">
                    <h3>ğŸ“„ ì‹¬ì˜ ëŒ€ìƒ ë¬¸ì„œë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</h3>
                    <p>ì—°êµ¬ê³„íšì„œ, ê²°ê³¼ë³´ê³ ì„œ, ì œì•ˆì„œ ë“± (PDF, TXT)</p>
                    <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                        ğŸ“‚ íŒŒì¼ ì„ íƒ
                    </button>
                </div>
                <div id="fileInfo" style="display: none; margin-top: 15px;"></div>
                
                <!-- ë˜ëŠ” ì§ì ‘ ì…ë ¥ -->
                <div style="text-align: center; margin: 20px 0; color: #888;">ë˜ëŠ”</div>
                <div class="input-group">
                    <label>ë¬¸ì„œ ë‚´ìš© ì§ì ‘ ì…ë ¥</label>
                    <textarea id="directInput" class="input-field" placeholder="ì‹¬ì˜ ëŒ€ìƒ ë¬¸ì„œì˜ í•µì‹¬ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...&#10;&#10;ì˜ˆì‹œ:&#10;[ì—°êµ¬ ëª©ì ]&#10;ë³¸ ì—°êµ¬ëŠ”...&#10;&#10;[ì—°êµ¬ ë°©ë²•]&#10;...&#10;&#10;[ê¸°ëŒ€ íš¨ê³¼]&#10;..."></textarea>
                </div>
            </div>
            
            <!-- ë¶„ì„ ì‹œì‘ ë²„íŠ¼ -->
            <div style="text-align: center; margin: 30px 0;">
                <button class="btn btn-primary" onclick="startAnalysis()" style="font-size: 18px; padding: 18px 50px;">
                    ğŸš€ N2B ì‹¬ì˜ ë¶„ì„ ì‹œì‘
                </button>
            </div>
        </div>
        
        <!-- íƒ­ 2: N2B ë¶„ì„ ê²°ê³¼ -->
        <div id="tab-analysis" class="tab-content card hidden">
            <h2>ğŸ” N2B êµ¬ì¡° ë¶„ì„ ê²°ê³¼</h2>
            
            <!-- ë¡œë”© -->
            <div id="analysisLoading" class="loading" style="display: none;">
                <div class="loading-spinner"></div>
                <h3>AIê°€ ë¬¸ì„œë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar" style="width: 0%;"></div>
                </div>
                <p id="loadingText">ë¬¸ì„œë¥¼ ì½ëŠ” ì¤‘...</p>
            </div>
            
            <!-- ë¶„ì„ ê²°ê³¼ -->
            <div id="analysisResult" style="display: none;">
                <!-- ì¢…í•© ì ìˆ˜ -->
                <div style="text-align: center; margin: 30px 0;">
                    <h3>ì¢…í•© í‰ê°€ ë“±ê¸‰</h3>
                    <span id="overallGrade" class="grade-badge grade-good">B+</span>
                    <p style="margin-top: 10px; color: #666;">í‰ê·  ì ìˆ˜: <span id="avgScore">4.0</span>/5.0</p>
                </div>
                
                <div class="score-dashboard" id="scoreDashboard"></div>
                
                <!-- N2B êµ¬ì¡° ë¶„ì„ -->
                <h3 style="margin: 30px 0 20px;">ğŸ“Š N2B êµ¬ì¡° ë¶„ì„</h3>
                <div class="n2b-result-grid" id="n2bResultGrid"></div>
                
                <!-- ëª…ì‹¤ìƒë¶€ & ê³µì¡´ ë¶„ì„ -->
                <h3 style="margin: 30px 0 20px;">ğŸ¯ ëª…ì‹¤ìƒë¶€ Â· ê³µì¡´ ë¶„ì„</h3>
                <div id="qualityAnalysis"></div>
            </div>
        </div>
        
        <!-- íƒ­ 3: ì‹¬ì˜ ì˜ê²¬ì„œ -->
        <div id="tab-opinion" class="tab-content card hidden">
            <h2>ğŸ“„ ì‹¬ì˜ ì˜ê²¬ì„œ (ì´ˆì•ˆ)</h2>
            
            <div id="opinionContent" style="display: none;">
                <div class="opinion-section">
                    <h4>ğŸ“‹ ì‹¬ì˜ ê°œìš”</h4>
                    <div class="opinion-content" id="opinionOverview"></div>
                </div>
                
                <div class="opinion-section">
                    <h4>âœ… ìš°ìˆ˜í•œ ì  (Strengths)</h4>
                    <div class="opinion-content" id="opinionStrengths"></div>
                </div>
                
                <div class="opinion-section">
                    <h4>âš ï¸ ë³´ì™„ì´ í•„ìš”í•œ ì  (Weaknesses)</h4>
                    <div class="opinion-content" id="opinionWeaknesses"></div>
                </div>
                
                <div class="opinion-section">
                    <h4>ğŸ’¡ ê°œì„  ê¶Œê³ ì‚¬í•­ (Recommendations)</h4>
                    <div class="opinion-content" id="opinionRecommendations"></div>
                </div>
                
                <div class="opinion-section">
                    <h4>ğŸ¯ ì¢…í•© ì˜ê²¬</h4>
                    <div class="opinion-content" id="opinionConclusion"></div>
                </div>
                
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="copyOpinion()">ğŸ“‹ ì˜ê²¬ì„œ ë³µì‚¬</button>
                    <button class="btn btn-success" onclick="downloadOpinion()">ğŸ“¥ ë‹¤ìš´ë¡œë“œ</button>
                    <button class="btn btn-secondary" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
                </div>
            </div>
            
            <div id="opinionPlaceholder">
                <p style="text-align: center; color: #888; padding: 40px;">
                    ë¨¼ì € "ì‹¬ì˜ ì…ë ¥" íƒ­ì—ì„œ ë¬¸ì„œë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”.
                </p>
            </div>
        </div>
        
        <!-- íƒ­ 4: ì²´í¬ë¦¬ìŠ¤íŠ¸ -->
        <div id="tab-checklist" class="tab-content card hidden">
            <h2>âœ… ì‹¬ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸</h2>
            
            <div id="checklistContent">
                <h3 style="margin: 20px 0 15px; color: #e94560;">ğŸ“Œ N2B ê´€ì  ì ê²€</h3>
                <div class="checklist" id="n2bChecklist"></div>
                
                <h3 style="margin: 30px 0 15px; color: #533483;">ğŸ“Œ ëª…ì‹¤ìƒë¶€ ì ê²€</h3>
                <div class="checklist" id="qualityChecklist"></div>
                
                <h3 style="margin: 30px 0 15px; color: #0f3460;">ğŸ“Œ ê³µì¡´ ì ê²€</h3>
                <div class="checklist" id="sustainChecklist"></div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <p id="checkProgress" style="font-size: 1.2em; color: #333;">ì™„ë£Œ: 0 / 0</p>
                    <div class="progress-bar" style="max-width: 400px; margin: 15px auto;">
                        <div id="checkProgressBar" class="progress-fill" style="width: 0%;"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- íƒ­ 5: ì‹¬ì˜ ê°€ì´ë“œ -->
        <div id="tab-guide" class="tab-content card hidden">
            <h2>ğŸ“š N2B ê¸°ë°˜ ì‹¬ì˜ ê°€ì´ë“œ</h2>
            
            <div class="opinion-section">
                <h4>ğŸ§¬ N2B í”„ë ˆì„ì›Œí¬ë€?</h4>
                <div class="opinion-content">
<strong>N2B (Not-But-Because)</strong>ëŠ” ëª¨ë“  ë…¼ì¦ì˜ ê¸°ë³¸ êµ¬ì¡°ì…ë‹ˆë‹¤.

<strong>N (Not)</strong> - ê¸°ì¡´ ê²¬í•´, í†µë…, í•œê³„ì 
"ì§€ê¸ˆê¹Œì§€ëŠ” ~ë¼ê³  ì•Œë ¤ì ¸ ìˆë‹¤" / "ê¸°ì¡´ ë°©ë²•ì€ ~í•œ ë¬¸ì œê°€ ìˆë‹¤"

<strong>B (But)</strong> - ì „í™˜ì , ìƒˆë¡œìš´ ì£¼ì¥, ì°¨ë³„ì 
"ê·¸ëŸ¬ë‚˜ ë³¸ ì—°êµ¬ì—ì„œëŠ” ~" / "í•˜ì§€ë§Œ ìƒˆë¡œìš´ ì ‘ê·¼ë²•ì„ í†µí•´ ~"

<strong>C (Because)</strong> - ê·¼ê±°, ì´ìœ , ì¦ê±°
"ì™œëƒí•˜ë©´ ~ì´ê¸° ë•Œë¬¸ì´ë‹¤" / "ê·¸ ì´ìœ ëŠ” ~"

<strong>ğŸ’¡ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</strong>
N2BëŠ” ë‹¨ìˆœí•œ ê¸€ì“°ê¸° ê¸°ë²•ì´ ì•„ë‹Œ, <strong>'ìƒê°ì˜ DNA'</strong>ì…ë‹ˆë‹¤.
ê°€ì„¤ê²€ì •ì˜ ë…¼ë¦¬(ê·€ë¬´ê°€ì„¤ â†’ ê¸°ê° â†’ ê·¼ê±°)ê°€ ëª¨ë“  ë‹´ë¡ ì— ì ìš©ë©ë‹ˆë‹¤.
                </div>
            </div>
            
            <div class="opinion-section">
                <h4>ğŸ¯ ëª…ì‹¤ìƒë¶€ (åå¯¦ç›¸ç¬¦) ì ê²€</h4>
                <div class="opinion-content">
<strong>ëª…ì‹¤ìƒë¶€</strong>ë€ "ì´ë¦„ê³¼ ì‹¤ì œê°€ ì„œë¡œ ë¶€í•©í•¨"ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì‹¬ì˜ì—ì„œ í™•ì¸í•  ì‚¬í•­:
â€¢ <strong>ëª©í‘œì™€ ë°©ë²•ì˜ ì¼ì¹˜</strong>: ì—°êµ¬ ëª©í‘œê°€ ë°©ë²•ë¡ ìœ¼ë¡œ ë‹¬ì„± ê°€ëŠ¥í•œê°€?
â€¢ <strong>ì£¼ì¥ê³¼ ê·¼ê±°ì˜ ì¼ì¹˜</strong>: ì£¼ì¥ì´ ì œì‹œëœ ê·¼ê±°ë¡œ ë’·ë°›ì¹¨ë˜ëŠ”ê°€?
â€¢ <strong>ê³„íšê³¼ ì—­ëŸ‰ì˜ ì¼ì¹˜</strong>: ì—°êµ¬íŒ€ì´ ê³„íšì„ ìˆ˜í–‰í•  ì—­ëŸ‰ì´ ìˆëŠ”ê°€?
â€¢ <strong>ê¸°ëŒ€íš¨ê³¼ì™€ í˜„ì‹¤ì˜ ì¼ì¹˜</strong>: ê¸°ëŒ€íš¨ê³¼ê°€ í˜„ì‹¤ì ìœ¼ë¡œ ë‹¬ì„± ê°€ëŠ¥í•œê°€?

<strong>âš ï¸ ê²½ê³„í•´ì•¼ í•  ê²ƒ</strong>
- ê³¼ëŒ€ í¬ì¥ëœ ê¸°ëŒ€íš¨ê³¼
- ê·¼ê±° ì—†ëŠ” ì°¨ë³„ì„± ì£¼ì¥
- ì‹¤í˜„ ë¶ˆê°€ëŠ¥í•œ ëª©í‘œ ì„¤ì •
                </div>
            </div>
            
            <div class="opinion-section">
                <h4>ğŸŒ± ê³µì¡´ (å…±å­˜) ì ê²€</h4>
                <div class="opinion-content">
<strong>ê³µì¡´</strong>ì´ë€ ì—°êµ¬ê°€ ë‹¤ì–‘í•œ ì´í•´ê´€ê³„ìì™€ ì¡°í™”ë¡­ê²Œ ê³µì¡´í•  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.

ì‹¬ì˜ì—ì„œ í™•ì¸í•  ì‚¬í•­:
â€¢ <strong>ì‚¬íšŒì  ê³µì¡´</strong>: ì—°êµ¬ ê²°ê³¼ê°€ ì‚¬íšŒì— ê¸ì •ì  ì˜í–¥ì„ ë¯¸ì¹˜ëŠ”ê°€?
â€¢ <strong>í™˜ê²½ì  ê³µì¡´</strong>: í™˜ê²½ì— ë¶€ì •ì  ì˜í–¥ì€ ì—†ëŠ”ê°€?
â€¢ <strong>ìœ¤ë¦¬ì  ê³µì¡´</strong>: ì—°êµ¬ìœ¤ë¦¬ë¥¼ ì¤€ìˆ˜í•˜ëŠ”ê°€?
â€¢ <strong>ê²½ì œì  ê³µì¡´</strong>: ì§€ì†ê°€ëŠ¥í•œ ì‚¬ì—…í™”/í™œìš©ì´ ê°€ëŠ¥í•œê°€?

<strong>ğŸ’¡ ì¢‹ì€ ì—°êµ¬ì˜ ì¡°ê±´</strong>
"ë‚˜ë§Œ ì˜ë˜ë©´ ëœë‹¤"ê°€ ì•„ë‹Œ, "í•¨ê»˜ ì˜ë˜ëŠ”" ì—°êµ¬
                </div>
            </div>
            
            <div class="opinion-section">
                <h4>ğŸ“ ì‹¬ì˜ ì˜ê²¬ ì‘ì„± íŒ</h4>
                <div class="opinion-content">
<strong>1. êµ¬ì²´ì ìœ¼ë¡œ ì‘ì„±í•˜ê¸°</strong>
âŒ "ì—°êµ¬ ë°©ë²•ì´ ë¯¸í¡í•¨"
âœ… "3ì¥ì˜ ì‹¤í—˜ ì„¤ê³„ì—ì„œ ëŒ€ì¡°êµ° ì„¤ì •ì´ ëˆ„ë½ë˜ì–´ ê²°ê³¼ì˜ ì‹ ë¢°ì„± í™•ë³´ê°€ ì–´ë ¤ì›€"

<strong>2. N2B êµ¬ì¡°ë¡œ ì‘ì„±í•˜ê¸°</strong>
"ê¸°ì¡´ ì—°êµ¬ì—ì„œëŠ” A ë°©ë²•ì„ ì‚¬ìš©í•˜ì˜€ìœ¼ë‚˜(N), ë³¸ ì—°êµ¬ì—ì„œëŠ” B ë°©ë²•ì„ ì œì•ˆí•˜ì˜€ë‹¤(B).
ê·¸ ì´ìœ ëŠ” C ë•Œë¬¸ì´ë‹¤(C). ë‹¤ë§Œ, D ë¶€ë¶„ì˜ ë³´ì™„ì´ í•„ìš”í•˜ë‹¤."

<strong>3. ê±´ì„¤ì  í”¼ë“œë°± ì œê³µí•˜ê¸°</strong>
ë¬¸ì œì ë§Œ ì§€ì í•˜ì§€ ë§ê³ , ê°œì„  ë°©í–¥ì„ í•¨ê»˜ ì œì‹œ

<strong>4. ê· í˜• ì¡íŒ í‰ê°€í•˜ê¸°</strong>
ì¥ì ê³¼ ë‹¨ì ì„ ëª¨ë‘ ì–¸ê¸‰í•˜ì—¬ ê³µì •í•œ í‰ê°€ ì œê³µ
                </div>
            </div>
        </div>
    </div>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script>
        // PDF.js ì„¤ì •
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        
        // ì „ì—­ ìƒíƒœ
        let currentAnalysis = null;
        let selectedReviewType = null;
        
        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ë°ì´í„°
        const checklistData = {
            n2b: [
                { id: 'n2b1', text: 'ê¸°ì¡´ ì—°êµ¬/ê¸°ìˆ ì˜ í•œê³„ì (N)ì´ ëª…í™•íˆ ì œì‹œë˜ì—ˆëŠ”ê°€?' },
                { id: 'n2b2', text: 'ìƒˆë¡œìš´ ì ‘ê·¼ë²•/ì£¼ì¥(B)ì´ ê¸°ì¡´ ëŒ€ë¹„ ì°¨ë³„ì„±ì´ ìˆëŠ”ê°€?' },
                { id: 'n2b3', text: 'ì£¼ì¥ì„ ë’·ë°›ì¹¨í•˜ëŠ” ê·¼ê±°(C)ê°€ ì¶©ë¶„íˆ ì œì‹œë˜ì—ˆëŠ”ê°€?' },
                { id: 'n2b4', text: 'Nâ†’Bâ†’Cì˜ ë…¼ë¦¬ì  íë¦„ì´ ìì—°ìŠ¤ëŸ¬ìš´ê°€?' },
                { id: 'n2b5', text: 'ê° ë‹¨ê³„ë³„ ë‚´ìš©ì´ êµ¬ì²´ì ì´ê³  ì¸¡ì • ê°€ëŠ¥í•œê°€?' }
            ],
            quality: [
                { id: 'q1', text: 'ì—°êµ¬ ëª©í‘œì™€ ë°©ë²•ë¡ ì´ ì¼ì¹˜í•˜ëŠ”ê°€?' },
                { id: 'q2', text: 'ì£¼ì¥ê³¼ ì œì‹œëœ ê·¼ê±°ê°€ ë¶€í•©í•˜ëŠ”ê°€?' },
                { id: 'q3', text: 'ì—°êµ¬íŒ€ì˜ ì—­ëŸ‰ì´ ê³„íš ìˆ˜í–‰ì— ì¶©ë¶„í•œê°€?' },
                { id: 'q4', text: 'ê¸°ëŒ€íš¨ê³¼ê°€ í˜„ì‹¤ì ìœ¼ë¡œ ë‹¬ì„± ê°€ëŠ¥í•œê°€?' },
                { id: 'q5', text: 'ì˜ˆì‚°ê³¼ ì¼ì • ê³„íšì´ ì ì ˆí•œê°€?' }
            ],
            sustain: [
                { id: 's1', text: 'ì—°êµ¬ ê²°ê³¼ì˜ ì‚¬íšŒì  íŒŒê¸‰íš¨ê³¼ê°€ ê¸ì •ì ì¸ê°€?' },
                { id: 's2', text: 'í™˜ê²½/ìœ¤ë¦¬ì  ë¬¸ì œê°€ ì—†ëŠ”ê°€?' },
                { id: 's3', text: 'ì§€ì†ê°€ëŠ¥í•œ í™œìš©/ì‚¬ì—…í™” ê³„íšì´ ìˆëŠ”ê°€?' },
                { id: 's4', text: 'ë‹¤ë¥¸ ì—°êµ¬/ì‚¬ì—…ê³¼ì˜ ì—°ê³„ ê°€ëŠ¥ì„±ì´ ìˆëŠ”ê°€?' },
                { id: 's5', text: 'ê´€ë ¨ ë²•ê·œ/ì œë„ì™€ ì¶©ëŒí•˜ì§€ ì•ŠëŠ”ê°€?' }
            ]
        };
        
        // íƒ­ ì „í™˜
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            event.target.classList.add('active');
        }
        
        // ì‹¬ì˜ ìœ í˜• ì„ íƒ
        function selectReviewType(element, type) {
            document.querySelectorAll('.review-type-card').forEach(el => el.classList.remove('selected'));
            element.classList.add('selected');
            selectedReviewType = type;
        }
        
        // íŒŒì¼ ì—…ë¡œë“œ ì²˜ë¦¬
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                showFileInfo(e.dataTransfer.files[0]);
            }
        });
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) showFileInfo(e.target.files[0]);
        });
        
        function showFileInfo(file) {
            document.getElementById('fileInfo').style.display = 'block';
            document.getElementById('fileInfo').innerHTML = `
                <div style="background: #e8f5e9; padding: 15px; border-radius: 10px;">
                    <strong>âœ… ì„ íƒëœ íŒŒì¼:</strong> ${file.name}<br>
                    <small>í¬ê¸°: ${(file.size / 1024).toFixed(1)} KB</small>
                </div>
            `;
        }
        
        // PDF í…ìŠ¤íŠ¸ ì¶”ì¶œ
        async function extractPDFText(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let text = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const content = await page.getTextContent();
                text += content.items.map(item => item.str).join(' ') + '\n';
            }
            return text.trim();
        }
        
        // ë¶„ì„ ì‹œì‘
        async function startAnalysis() {
            const reviewerName = document.getElementById('reviewerName').value;
            const apiKey = document.getElementById('apiKey').value;
            const file = fileInput.files[0];
            const directInput = document.getElementById('directInput').value;
            
            // ê²€ì¦
            if (!reviewerName.trim()) {
                alert('ì‹¬ì˜ìœ„ì› ì„±ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!apiKey.trim()) {
                alert('OpenAI API Keyë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!file && !directInput.trim()) {
                alert('ë¶„ì„í•  ë¬¸ì„œë¥¼ ì—…ë¡œë“œí•˜ê±°ë‚˜ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!selectedReviewType) {
                alert('ì‹¬ì˜ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // íƒ­ ì „í™˜ ë° ë¡œë”© í‘œì‹œ
            showTab('analysis');
            document.getElementById('analysisLoading').style.display = 'block';
            document.getElementById('analysisResult').style.display = 'none';
            
            try {
                // í…ìŠ¤íŠ¸ ì¶”ì¶œ
                updateProgress(20, 'ë¬¸ì„œì—ì„œ í…ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ëŠ” ì¤‘...');
                let text = directInput.trim();
                if (file) {
                    if (file.name.toLowerCase().endsWith('.pdf')) {
                        text = await extractPDFText(file);
                    } else {
                        text = await file.text();
                    }
                }
                
                if (text.length < 50) {
                    throw new Error('í…ìŠ¤íŠ¸ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ë” ë§ì€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                
                // AI ë¶„ì„
                updateProgress(50, 'AIê°€ N2B êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘...');
                const analysis = await performN2BAnalysis(apiKey, text, selectedReviewType);
                
                // ê²°ê³¼ ì €ì¥
                updateProgress(90, 'ê²°ê³¼ë¥¼ ì •ë¦¬í•˜ëŠ” ì¤‘...');
                currentAnalysis = {
                    reviewer: {
                        name: reviewerName,
                        org: document.getElementById('reviewerOrg').value,
                        field: document.getElementById('reviewerField').value
                    },
                    reviewType: selectedReviewType,
                    document: text,
                    analysis: analysis,
                    timestamp: new Date()
                };
                
                // ê²°ê³¼ í‘œì‹œ
                updateProgress(100, 'ì™„ë£Œ!');
                setTimeout(() => {
                    document.getElementById('analysisLoading').style.display = 'none';
                    document.getElementById('analysisResult').style.display = 'block';
                    displayAnalysisResult();
                    displayOpinion();
                    initializeChecklist();
                }, 500);
                
            } catch (error) {
                document.getElementById('analysisLoading').style.display = 'none';
                alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = percent + '%';
            document.getElementById('loadingText').textContent = text;
        }
        
        // N2B ë¶„ì„ API í˜¸ì¶œ
        async function performN2BAnalysis(apiKey, text, reviewType) {
            const reviewTypeNames = {
                planning: 'ê¸°íší‰ê°€',
                selection: 'ì„ ì •í‰ê°€',
                interim: 'ì¤‘ê°„í‰ê°€',
                final: 'ìµœì¢…í‰ê°€',
                followup: 'ì¶”ì í‰ê°€',
                other: 'ê¸°íƒ€ ì‹¬ì˜'
            };
            
            const prompt = `ë‹¹ì‹ ì€ ì—°êµ¬ê°œë°œ ê³¼ì œ ì‹¬ì˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ë‹¤ìŒ ë¬¸ì„œë¥¼ N2B(Not-But-Because) í”„ë ˆì„ì›Œí¬ë¡œ ë¶„ì„í•˜ê³ , ì‹¬ì˜ ì˜ê²¬ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.

[ì‹¬ì˜ ìœ í˜•]: ${reviewTypeNames[reviewType]}

[ë¬¸ì„œ ë‚´ìš©]:
${text.substring(0, 6000)}

ë‹¤ìŒ JSON í˜•ì‹ìœ¼ë¡œ ìƒì„¸í•˜ê²Œ ë¶„ì„í•´ì£¼ì„¸ìš”:

{
    "scores": {
        "n_score": 4.0,
        "b_score": 3.5,
        "c_score": 4.2,
        "ëª…ì‹¤ìƒë¶€": 3.8,
        "ê³µì¡´": 4.0,
        "average": 3.9
    },
    "grade": "B+",
    "n_elements": [
        "ê¸°ì¡´ ì—°êµ¬/ê¸°ìˆ ì˜ í•œê³„ì ì´ë‚˜ ë¬¸ì œì  (3-5ê°œ)"
    ],
    "b_elements": [
        "ìƒˆë¡œìš´ ì ‘ê·¼ë²•ì´ë‚˜ ì°¨ë³„ì  (3-5ê°œ)"
    ],
    "c_elements": [
        "ê·¼ê±°ë‚˜ ì´ìœ  (3-5ê°œ)"
    ],
    "ëª…ì‹¤ìƒë¶€_analysis": {
        "ì¼ì¹˜í•˜ëŠ”_ì ": ["ëª©í‘œì™€ ë°©ë²•ì´ ì¼ì¹˜í•˜ëŠ” ë¶€ë¶„ë“¤"],
        "ë¶ˆì¼ì¹˜í•˜ëŠ”_ì ": ["ì´ë¦„ê³¼ ì‹¤ì œê°€ ë§ì§€ ì•ŠëŠ” ë¶€ë¶„ë“¤"],
        "ê°œì„ _í•„ìš”": ["ëª…ì‹¤ìƒë¶€ë¥¼ ìœ„í•´ ë³´ì™„í•´ì•¼ í•  ì "]
    },
    "ê³µì¡´_analysis": {
        "ê¸ì •ì _ìš”ì†Œ": ["ì‚¬íšŒ/í™˜ê²½/ê²½ì œì ìœ¼ë¡œ ê¸ì •ì ì¸ ì "],
        "ìš°ë ¤_ìš”ì†Œ": ["ì§€ì†ê°€ëŠ¥ì„± ì¸¡ë©´ì—ì„œ ìš°ë ¤ë˜ëŠ” ì "],
        "ê¶Œê³ ì‚¬í•­": ["ê³µì¡´ì„ ìœ„í•œ ê¶Œê³ ì‚¬í•­"]
    },
    "opinion": {
        "overview": "ì‹¬ì˜ ëŒ€ìƒ ê³¼ì œì— ëŒ€í•œ ì „ì²´ ê°œìš” (2-3ë¬¸ì¥)",
        "strengths": ["ìš°ìˆ˜í•œ ì  3-5ê°œ (êµ¬ì²´ì ìœ¼ë¡œ)"],
        "weaknesses": ["ë³´ì™„ì´ í•„ìš”í•œ ì  3-5ê°œ (êµ¬ì²´ì ìœ¼ë¡œ)"],
        "recommendations": ["ê°œì„  ê¶Œê³ ì‚¬í•­ 3-5ê°œ (êµ¬ì²´ì ìœ¼ë¡œ)"],
        "conclusion": "ì¢…í•© ì˜ê²¬ (3-4ë¬¸ì¥, N2B êµ¬ì¡°ë¡œ ì‘ì„±)"
    }
}

ë¶„ì„ ì‹œ ë‹¤ìŒ ì‚¬í•­ì„ ê³ ë ¤í•´ì£¼ì„¸ìš”:
1. N2B êµ¬ì¡°ê°€ ì–¼ë§ˆë‚˜ ëª…í™•í•˜ê²Œ ë“œëŸ¬ë‚˜ëŠ”ì§€
2. ëª…ì‹¤ìƒë¶€: ì£¼ì¥ê³¼ ê·¼ê±°, ëª©í‘œì™€ ë°©ë²•ì´ ì¼ì¹˜í•˜ëŠ”ì§€
3. ê³µì¡´: ì‚¬íšŒì /í™˜ê²½ì /ê²½ì œì  ì§€ì†ê°€ëŠ¥ì„±ì´ ìˆëŠ”ì§€
4. ì‹¬ì˜ ìœ í˜•(${reviewTypeNames[reviewType]})ì— ë§ëŠ” ê´€ì ì—ì„œ í‰ê°€`;

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-4o-mini',
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 3000,
                    temperature: 0.3
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'API í˜¸ì¶œ ì‹¤íŒ¨');
            }
            
            const data = await response.json();
            const content = data.choices[0].message.content;
            const jsonMatch = content.match(/\{[\s\S]*\}/);
            
            if (jsonMatch) {
                return JSON.parse(jsonMatch[0]);
            }
            throw new Error('AI ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜');
        }
        
        // ë¶„ì„ ê²°ê³¼ í‘œì‹œ
        function displayAnalysisResult() {
            const analysis = currentAnalysis.analysis;
            
            // ë“±ê¸‰ í‘œì‹œ
            const gradeEl = document.getElementById('overallGrade');
            gradeEl.textContent = analysis.grade;
            gradeEl.className = 'grade-badge ' + getGradeClass(analysis.grade);
            document.getElementById('avgScore').textContent = analysis.scores.average.toFixed(1);
            
            // ì ìˆ˜ ëŒ€ì‹œë³´ë“œ
            document.getElementById('scoreDashboard').innerHTML = `
                <div class="score-item">
                    <div class="score-value">${analysis.scores.n_score}</div>
                    <div class="score-label">N (í•œê³„ ì¸ì‹)</div>
                </div>
                <div class="score-item">
                    <div class="score-value">${analysis.scores.b_score}</div>
                    <div class="score-label">B (ì°¨ë³„ì„±)</div>
                </div>
                <div class="score-item">
                    <div class="score-value">${analysis.scores.c_score}</div>
                    <div class="score-label">C (ê·¼ê±°)</div>
                </div>
                <div class="score-item ëª…ì‹¤ìƒë¶€">
                    <div class="score-value">${analysis.scores.ëª…ì‹¤ìƒë¶€}</div>
                    <div class="score-label">ëª…ì‹¤ìƒë¶€</div>
                </div>
                <div class="score-item ê³µì¡´">
                    <div class="score-value">${analysis.scores.ê³µì¡´}</div>
                    <div class="score-label">ê³µì¡´</div>
                </div>
            `;
            
            // N2B êµ¬ì¡° ë¶„ì„
            document.getElementById('n2bResultGrid').innerHTML = `
                <div class="n2b-box n-box">
                    <h4>ğŸš« N (Not) - ê¸°ì¡´ í•œê³„</h4>
                    <ul>${analysis.n_elements.map(el => `<li>${el}</li>`).join('')}</ul>
                </div>
                <div class="n2b-box b-box">
                    <h4>â¡ï¸ B (But) - ìƒˆë¡œìš´ ì ‘ê·¼</h4>
                    <ul>${analysis.b_elements.map(el => `<li>${el}</li>`).join('')}</ul>
                </div>
                <div class="n2b-box c-box">
                    <h4>âœ… C (Because) - ê·¼ê±°</h4>
                    <ul>${analysis.c_elements.map(el => `<li>${el}</li>`).join('')}</ul>
                </div>
            `;
            
            // ëª…ì‹¤ìƒë¶€ & ê³µì¡´ ë¶„ì„
            document.getElementById('qualityAnalysis').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: #fdf4ff; padding: 20px; border-radius: 12px; border-left: 5px solid #a855f7;">
                        <h4 style="color: #a855f7; margin-bottom: 15px;">ğŸ¯ ëª…ì‹¤ìƒë¶€ ë¶„ì„</h4>
                        <p><strong>âœ… ì¼ì¹˜í•˜ëŠ” ì :</strong></p>
                        <ul>${analysis.ëª…ì‹¤ìƒë¶€_analysis.ì¼ì¹˜í•˜ëŠ”_ì .map(el => `<li>${el}</li>`).join('')}</ul>
                        <p style="margin-top: 10px;"><strong>âš ï¸ ë¶ˆì¼ì¹˜í•˜ëŠ” ì :</strong></p>
                        <ul>${analysis.ëª…ì‹¤ìƒë¶€_analysis.ë¶ˆì¼ì¹˜í•˜ëŠ”_ì .map(el => `<li>${el}</li>`).join('')}</ul>
                    </div>
                    <div style="background: #f0fdfa; padding: 20px; border-radius: 12px; border-left: 5px solid #14b8a6;">
                        <h4 style="color: #14b8a6; margin-bottom: 15px;">ğŸŒ± ê³µì¡´ ë¶„ì„</h4>
                        <p><strong>âœ… ê¸ì •ì  ìš”ì†Œ:</strong></p>
                        <ul>${analysis.ê³µì¡´_analysis.ê¸ì •ì _ìš”ì†Œ.map(el => `<li>${el}</li>`).join('')}</ul>
                        <p style="margin-top: 10px;"><strong>âš ï¸ ìš°ë ¤ ìš”ì†Œ:</strong></p>
                        <ul>${analysis.ê³µì¡´_analysis.ìš°ë ¤_ìš”ì†Œ.map(el => `<li>${el}</li>`).join('')}</ul>
                    </div>
                </div>
            `;
        }
        
        function getGradeClass(grade) {
            if (grade.includes('A')) return 'grade-excellent';
            if (grade.includes('B')) return 'grade-good';
            if (grade.includes('C')) return 'grade-normal';
            return 'grade-poor';
        }
        
        // ì‹¬ì˜ ì˜ê²¬ì„œ í‘œì‹œ
        function displayOpinion() {
            const opinion = currentAnalysis.analysis.opinion;
            const reviewer = currentAnalysis.reviewer;
            
            document.getElementById('opinionPlaceholder').style.display = 'none';
            document.getElementById('opinionContent').style.display = 'block';
            
            const reviewTypeNames = {
                planning: 'ê¸°íší‰ê°€',
                selection: 'ì„ ì •í‰ê°€',
                interim: 'ì¤‘ê°„í‰ê°€',
                final: 'ìµœì¢…í‰ê°€',
                followup: 'ì¶”ì í‰ê°€',
                other: 'ê¸°íƒ€ ì‹¬ì˜'
            };
            
            document.getElementById('opinionOverview').innerHTML = `
<strong>ì‹¬ì˜ ìœ í˜•:</strong> ${reviewTypeNames[currentAnalysis.reviewType]}
<strong>ì‹¬ì˜ìœ„ì›:</strong> ${reviewer.name} (${reviewer.org || '-'})
<strong>ì „ë¬¸ ë¶„ì•¼:</strong> ${reviewer.field || '-'}
<strong>ì‹¬ì˜ ì¼ì‹œ:</strong> ${currentAnalysis.timestamp.toLocaleString('ko-KR')}

<strong>ì‹¬ì˜ ê°œìš”:</strong>
${opinion.overview}
            `;
            
            document.getElementById('opinionStrengths').innerHTML = 
                opinion.strengths.map((s, i) => `${i+1}. ${s}`).join('\n\n');
            
            document.getElementById('opinionWeaknesses').innerHTML = 
                opinion.weaknesses.map((w, i) => `${i+1}. ${w}`).join('\n\n');
            
            document.getElementById('opinionRecommendations').innerHTML = 
                opinion.recommendations.map((r, i) => `${i+1}. ${r}`).join('\n\n');
            
            document.getElementById('opinionConclusion').innerHTML = `
<strong>ì¢…í•© ë“±ê¸‰:</strong> ${currentAnalysis.analysis.grade} (í‰ê·  ${currentAnalysis.analysis.scores.average.toFixed(1)}/5.0)

${opinion.conclusion}
            `;
        }
        
        // ì˜ê²¬ì„œ ë³µì‚¬
        function copyOpinion() {
            const opinion = currentAnalysis.analysis.opinion;
            const reviewer = currentAnalysis.reviewer;
            
            const text = `
[ì‹¬ì˜ ì˜ê²¬ì„œ]
====================================
ì‹¬ì˜ìœ„ì›: ${reviewer.name}
ì†Œì†: ${reviewer.org || '-'}
ì‹¬ì˜ì¼: ${currentAnalysis.timestamp.toLocaleDateString('ko-KR')}

[ì‹¬ì˜ ê°œìš”]
${opinion.overview}

[ìš°ìˆ˜í•œ ì ]
${opinion.strengths.map((s, i) => `${i+1}. ${s}`).join('\n')}

[ë³´ì™„ì´ í•„ìš”í•œ ì ]
${opinion.weaknesses.map((w, i) => `${i+1}. ${w}`).join('\n')}

[ê°œì„  ê¶Œê³ ì‚¬í•­]
${opinion.recommendations.map((r, i) => `${i+1}. ${r}`).join('\n')}

[ì¢…í•© ì˜ê²¬]
ë“±ê¸‰: ${currentAnalysis.analysis.grade}
${opinion.conclusion}
====================================
            `.trim();
            
            navigator.clipboard.writeText(text).then(() => {
                alert('ì‹¬ì˜ ì˜ê²¬ì„œê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });
        }
        
        // ì˜ê²¬ì„œ ë‹¤ìš´ë¡œë“œ
        function downloadOpinion() {
            const opinion = currentAnalysis.analysis.opinion;
            const reviewer = currentAnalysis.reviewer;
            
            const text = `ì‹¬ì˜ ì˜ê²¬ì„œ
====================================

[ê¸°ë³¸ ì •ë³´]
ì‹¬ì˜ìœ„ì›: ${reviewer.name}
ì†Œì†: ${reviewer.org || '-'}
ì „ë¬¸ë¶„ì•¼: ${reviewer.field || '-'}
ì‹¬ì˜ì¼: ${currentAnalysis.timestamp.toLocaleDateString('ko-KR')}

[ì‹¬ì˜ ê°œìš”]
${opinion.overview}

[N2B ë¶„ì„ ê²°ê³¼]
â€¢ N (í•œê³„ ì¸ì‹): ${currentAnalysis.analysis.scores.n_score}/5.0
â€¢ B (ì°¨ë³„ì„±): ${currentAnalysis.analysis.scores.b_score}/5.0
â€¢ C (ê·¼ê±°): ${currentAnalysis.analysis.scores.c_score}/5.0
â€¢ ëª…ì‹¤ìƒë¶€: ${currentAnalysis.analysis.scores.ëª…ì‹¤ìƒë¶€}/5.0
â€¢ ê³µì¡´: ${currentAnalysis.analysis.scores.ê³µì¡´}/5.0

[ìš°ìˆ˜í•œ ì ]
${opinion.strengths.map((s, i) => `${i+1}. ${s}`).join('\n')}

[ë³´ì™„ì´ í•„ìš”í•œ ì ]
${opinion.weaknesses.map((w, i) => `${i+1}. ${w}`).join('\n')}

[ê°œì„  ê¶Œê³ ì‚¬í•­]
${opinion.recommendations.map((r, i) => `${i+1}. ${r}`).join('\n')}

[ì¢…í•© ì˜ê²¬]
í‰ê°€ ë“±ê¸‰: ${currentAnalysis.analysis.grade} (í‰ê·  ${currentAnalysis.analysis.scores.average.toFixed(1)}/5.0)

${opinion.conclusion}

====================================
ìŠ¬ê¸°ë¡œìš´ ì‹¬ì˜ ìƒí™œ - N2B ê¸°ë°˜ ì‹¬ì˜ ë„ìš°ë¯¸
            `.trim();
            
            const blob = new Blob(['\uFEFF' + text], { type: 'text/plain;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ì‹¬ì˜ì˜ê²¬ì„œ_${reviewer.name}_${new Date().toISOString().slice(0,10)}.txt`;
            link.click();
        }
        
        // ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
        function initializeChecklist() {
            renderChecklist('n2bChecklist', checklistData.n2b);
            renderChecklist('qualityChecklist', checklistData.quality);
            renderChecklist('sustainChecklist', checklistData.sustain);
            updateCheckProgress();
        }
        
        function renderChecklist(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map(item => `
                <div class="checklist-item" onclick="toggleCheck('${item.id}')">
                    <input type="checkbox" id="${item.id}" onchange="updateCheckProgress()">
                    <label for="${item.id}">${item.text}</label>
                </div>
            `).join('');
        }
        
        function toggleCheck(id) {
            const checkbox = document.getElementById(id);
            checkbox.checked = !checkbox.checked;
            checkbox.closest('.checklist-item').classList.toggle('checked', checkbox.checked);
            updateCheckProgress();
        }
        
        function updateCheckProgress() {
            const total = document.querySelectorAll('.checklist-item input').length;
            const checked = document.querySelectorAll('.checklist-item input:checked').length;
            const percent = total > 0 ? (checked / total * 100) : 0;
            
            document.getElementById('checkProgress').textContent = `ì™„ë£Œ: ${checked} / ${total}`;
            document.getElementById('checkProgressBar').style.width = percent + '%';
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initializeChecklist);
    </script>
</body>
</html>
